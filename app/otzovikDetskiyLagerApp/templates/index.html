{% extends 'base.html' %}
{% block content %}
<div class="container">
  <div class="card" style="text-align:center;">
    <h1>Региональный фестиваль рабочих профессий для дошкольников «Мастерская открытий»</h1>
    <img src="/static/images/logo.png" alt="Логотип фестиваля" style="max-width:180px; margin: 18px auto; display:block;">
  </div>
  <div class="card">
    <h2>Этапы проведения</h2>
    <ul>
      <li>Прием заявок: 01.09.2025 – 30.09.2025</li>
      <li>Прием конкурсных работ: 15.09.2025 – 30.09.2025</li>
      <li>Отборочный этап (заочный): 01.10.2025 – 31.10.2025</li>
      <li>Финал (очный): 23.11.2025</li>
    </ul>
  </div>
  <div class="card">
    <h2>Таймеры этапов</h2>
    <ul>
      {% for stage in stage_names %}
        {% if stage in stages %}
          {% with stage_obj=stages.stage %}
          <li><b>{{ stage }}</b>:
            {% if now < stage_obj.start %}
              До старта: <span class="timer" data-time="{{ stage_obj.start|date:'c' }}"></span>
            {% elif now < stage_obj.end %}
              До окончания: <span class="timer" data-time="{{ stage_obj.end|date:'c' }}"></span>
            {% else %}
              Завершён
            {% endif %}
          </li>
          {% endwith %}
        {% endif %}
      {% endfor %}
    </ul>
  </div>
  <div class="card">
    <h2>Контакты</h2>
    <p>МАДОУ №247: 8 (343) 38-58-247, 89634440780</p>
  </div>
</div>
<script>
function updateTimers() {
    document.querySelectorAll('.timer').forEach(function(el) {
        var end = new Date(el.dataset.time);
        var now = new Date();
        var diff = Math.floor((end - now) / 1000);
        if (diff > 0) {
            var d = Math.floor(diff / 86400);
            var h = Math.floor((diff % 86400) / 3600);
            var m = Math.floor((diff % 3600) / 60);
            var s = diff % 60;
            el.textContent = `${d}д ${h}ч ${m}м ${s}с`;
        } else {
            el.textContent = 'Завершён';
        }
    });
}
setInterval(updateTimers, 1000);
updateTimers();
</script>
{% endblock %}
